<%
  page_title = Typus::I18n.t("Edit %{resource}", :resource => @resource.model_name.human)
  admin_title(page_title)
%>

<% content_for :main_grid do %>
  <%= render 'edit' %>

  <h1>
    <%= page_title %>
  </h1>

  <% if headless_mode? && params[:action] == 'edit' && flash.keys.include?(:notice) && !params[:_input] %>
    <%= javascript_tag do %>
      $(document).ready(function () {
        <% if params[:attribute] %>
          var option = new Option("<%=j @item.to_label.html_safe %>", "<%= @item.id %>", true, true);
          parent.$("#<%= params[:attribute] %>").append(option);
          parent.$(".chzn-select-<%= params[:attribute] %>").trigger("liszt:updated");
        <% else %>
          parent.Typus.parent_location_reload = true;
        <% end %>
        parent.$.fancybox.close();
      });
    <% end %>
  <% end %>

  <%= admin_display_flash_message %>

  <% locals = { :options => params.dup.cleanup.merge!(:action => 'update') } %>
  <%= render 'form', locals %>

  <%= typus_relationships unless headless_mode? %>
<% end %>
