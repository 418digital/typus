<%
  chosen_class = "chzn-select-#{attribute_id}"
  new_page_title = Typus::I18n.t("Add New %{resource}", :resource => related.model_name.human.titleize)
%>

<div id="modal-from-dom-<%= attribute_id %>" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3><%= new_page_title %></h3>
  </div>
  <div class="modal-body"></div>
</div>

<div class="clearfix" id="<%= attribute_id %>_li">
  <%= form.label attribute, label_text %>
  <% if values.kind_of?(String) %>
    <%= select_tag related_fk, values.html_safe, options.merge(html_options).merge(:class => chosen_class, :style => "width: 350px;", :id => "#{form.object.class.name.underscore}_#{related_fk}", :name => "#{form.object.class.name.underscore}[#{related_fk}]") %>
  <% elsif values.any? %>
    <%= form.select related_fk, values, options, html_options.merge(:class => chosen_class, :style => "width: 350px;") %>
  <% else %>
    <%= Typus::I18n.t("No %{resources} found.", :resources => related.model_name.human.downcase.pluralize) %>
  <% end %>
</div>

<script type="text/javascript">
  $(document).ready(function () { $(".<%= chosen_class %>").chosen({allow_single_deselect: true}); });
</script>
